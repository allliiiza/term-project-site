<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>
<body>
    <header>
        <%- include('./partials/navbar') %>
    </header>
    <main>
        <div class="profile-container">
            <h1>Your Profile</h1>
            <input type="checkbox" id="check">
            <label for="check" class="popupbtn">Login Here</label>
            <% if (user) { %>
                <div class="profile-info">
                    <p><strong>Email:</strong> <%= user.email %></p>
                    
                    <!-- Purchase History -->
                    <h2>Purchase History</h2>
                    <% if (user.purchaseHistory && user.purchaseHistory.length > 0) { %>
                        <ul class="purchase-history">
                            <% user.purchaseHistory.forEach(purchase => { %>
                                <li>
                                    <p>Date: <%= new Date(purchase.date).toLocaleDateString() %></p>
                                    <p>Total: $<%= purchase.totalAmount %></p>
                                </li>
                            <% }); %>
                        </ul>
                    <% } else { %>
                        <p>No purchase history available.</p>
                    <% } %>

                    <!-- Favorites -->
                    <h2>Favorites</h2>
                    <% if (user.favorites && user.favorites.length > 0) { %>
                        <ul class="favorites-list">
                            <% user.favorites.forEach(favorite => { %>
                                <li>
                                    <a href="/products/<%= favorite._id %>">
                                        <%= favorite.name %>
                                    </a>
                                </li>
                            <% }); %>
                        </ul>
                    <% } else { %>
                        <p>No favorites added yet.</p>
                    <% } %>
                </div>
                
                <!-- Logout Button -->
                <form action="/users/logout" method="POST">
                    <button type="submit" class="logout-btn">Logout</button>
                </form>
            <% } else { %>
                <p>Please <a href="/users/login">login</a> to view your profile.</p>
            <% } %>
        </div>
        <div class="login-container">
            <div class="close-button">
                <label for="check">
                    <i class="fa fa-times"></i>
                </label>
                <h1>Login</h1>
                <form action="/users/login" method="POST">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="Email" required>
                    <input type="password" name="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
                <% if (typeof error !== 'undefined') { %>
                    <div class="error-message">
                        <%= error %>
                    </div>
                <% } %>
            </div>
        </div>
    </main>
</body>
</html>
